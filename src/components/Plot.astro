---
import { Year } from "../grax-search/opportunity";

const { root } = Astro.props;

const months = await Year(2024, 6);
const labels = months.map((month, n) => 12 - n);
const totals = months.map((month) => {
  const amounts = month.map((record) => record.fields?.find((f) => f.name == "Amount")?.value).map((v) => parseFloat(v || "0"));

  return amounts.reduce((a, b) => a + b, 0);
});

const data: Plotly.Data[] = [
  {
    x: labels,
    y: totals,
    type: "bar",
  },
];
---

<script define:vars={{ data, root }} is:inline>
  window.data = data;
  window.root = root;
</script>

<script>
  import Plotly from "plotly.js-dist-min";
  const { data, root } = window;
  Plotly.newPlot(root, data);
</script>
